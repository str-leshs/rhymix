<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>뮤직 캘린더</title>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <style>
        #calendar {
            max-width: 900px;
            margin: 50px auto;
        }

        .fc-event-title {
            display: none;
        }

        .fc-event {
            background: none !important;
            border: none !important;
        }

        /* 캘린더 셀에 삽입될 앨범 커버 이미지 스타일 */
        .cover-thumb {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 5px;
            display: block;
            margin: 0 auto; /* 가운데 정렬 */
        }
        .fc-daygrid-day-frame {
            height: 100px;  /* 원하는 높이로 고정 가능 */
        }


        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 300px;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .modal-content h3 {
            margin-top: 0;
        }

        .modal-content img {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* 닫기 버튼 (우측 상단) */
        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #666;
        }

        .modal-close-btn:hover {
            color: #000;
        }

    </style>

</head>
<body>
    <div id="calendar"></div>

    <div id="trackDetailModal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close-btn" onclick="closeDetailModal()">✕</button>
            <h3>추천곡 상세정보</h3>
            <img id="modalDetailCover" src="" alt="앨범 커버">
            <p><strong>제목:</strong> <span id="modalDetailTitle"></span></p>
            <p><strong>아티스트:</strong> <span id="modalDetailArtist"></span></p>
            <p><strong>기분:</strong> <span id="modalDetailMood"></span></p>
            <p><strong>날씨:</strong> <span id="modalDetailWeather"></span></p>
            <p><strong>코멘트:</strong> <span id="modalDetailComment"></span></p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');
            const userId = "lion01";

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                events: `/api/calendar/events?userId=${userId}`,

                // 캘린더 셀에 앨범 커버만 표시
                eventContent: function (arg) {
                    const img = document.createElement('img');  //이미지 요소 생성
                    img.src = arg.event.extendedProps.cover;    // 앨범 커버 이미지 URL 할당
                    img.className = 'cover-thumb';
                    return { domNodes: [img] }; //이미지 삽입
                },

                // 앨범 커버 클릭 시 상세 모달 열기
                eventClick: async function (info) {
                    const date = info.event.startStr;

                    try {
                        const res = await fetch(`/api/calendar/date?userId=${userId}&date=${date}`);

                        if (!res.ok) return alert("추천곡을 불러올 수 없습니다.");

                        const data = await res.json();
                        document.getElementById("modalDetailTitle").textContent = data.title;
                        document.getElementById("modalDetailArtist").textContent = data.artist;
                        document.getElementById("modalDetailMood").textContent = data.mood || "-";
                        document.getElementById("modalDetailWeather").textContent = data.weather || "-";
                        document.getElementById("modalDetailComment").textContent = data.comment || "-";
                        document.getElementById("modalDetailCover").src = data.cover || "/image/default-cover.png";

                        document.getElementById("trackDetailModal").style.display = "flex";
                    } catch (e) {
                        console.error(e);
                        alert("오류 발생");
                    }
                }
            });

            calendar.render();  //화면에 렌더링
        });

        // 모달 닫기
        function closeDetailModal() {
            document.getElementById("trackDetailModal").style.display = "none";
        }
    </script>

</body>
</html>
