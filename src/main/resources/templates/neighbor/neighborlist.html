<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Ïù¥ÏõÉ Î¶¨Ïä§Ìä∏</title>
    <link rel="stylesheet" th:href="@{/css/neighborlist.css}">
    <style>
        .nickname {
            display: inline-block;
            max-width: 100px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            vertical-align: middle;
        }
        .delete-btn {
            margin-left: 10px;
            padding: 4px 8px;
            font-size: 0.8rem;
            background-color: #f55;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .alert {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.3); /* Ïñ¥ÎëêÏö¥ Î∞∞Í≤Ω */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .alert.hidden {
            display: none;
        }

        .alert-box {
            background-color: #fff8cc;
            padding: 2rem 3rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
            border: 2px solid #f2cc0f;
        }

        .alert .buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }
        .alert .buttons button {
            padding: 0.5rem 1.2rem;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
        #confirm-cancel {
            background-color: #ccc;
            border: none;
        }
        #confirm-ok {
            background-color: #f44336;
            border: none;
            color: white;
        }

    </style>
</head>
<body>

<!-- Ìó§Îçî -->
<header class="header">
    <div class="logo-wrap">
        <a th:href="@{/main}">
        <img th:src="@{/image/logo2.png}" class="logo" alt="Î°úÍ≥†" />
        </a>
    </div>

    <div class="button-row">
        <button class="btn active">LIST üìÅ</button>
        <a th:href="@{/recommend}"><button class="btn">SEARCH üîç</button></a>
    </div>
</header>

<div class="highlight-band"></div>

<div class="container">

    <!-- Î†àÏΩîÎìúÌåê Ïù¥ÎØ∏ÏßÄ -->
    <div class="vinyl">
        <img th:src="@{/image/vinyl.png}" alt="Î†àÏΩîÎìúÌåê Ïù¥ÎØ∏ÏßÄ" />
    </div>

    <!-- Ïù¥ÏõÉ Î¶¨Ïä§Ìä∏ -->
    <section class="neighbor-list">

        <!-- ÏôºÏ™Ω Ïª¨Îüº -->
        <div class="neighbor-column">
            <div class="neighbor-inner-box">
                <div class="neighbor-item" th:each="neighbor : ${leftList}">
                    <img th:src="${neighbor.profileImage}"
                         alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ"
                         onerror="this.onerror=null; this.src='/image/placeholder_circle.png';" />
                    <a th:href="@{'/mypage/' + ${neighbor.nickname}}">
                        <span th:text="${neighbor.nickname}" class="nickname">ÎãâÎÑ§ÏûÑ</span>
                    </a>
                    <button class="delete-btn" th:data-nickname="${neighbor.nickname}">ÏÇ≠Ï†ú</button>
                </div>
            </div>
        </div>

        <!-- Ïò§Î•∏Ï™Ω Ïª¨Îüº -->
        <div class="neighbor-column">
            <div class="neighbor-inner-box">
                <div class="neighbor-item" th:each="neighbor : ${rightList}">
                    <img th:src="${neighbor.profileImage}"
                         alt="ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ"
                         onerror="this.onerror=null; this.src='/image/placeholder_circle.png';" />
                    <a th:href="@{'/mypage/' + ${neighbor.nickname}}">
                        <span th:text="${neighbor.nickname}" class="nickname">ÎãâÎÑ§ÏûÑ</span>
                    </a>
                    <button type="button" class="delete-btn" th:data-nickname="${neighbor.nickname}">ÏÇ≠Ï†ú</button>
                </div>
            </div>
        </div>


    </section>

    <div id="confirm-alert" class="alert hidden">
        <div class="alert-box">
            <p id="confirm-message"></p>
            <div class="buttons">
                <button type="button" id="confirm-cancel">Ï∑®ÏÜå</button>
                <button type="button" id="confirm-ok">ÏÇ≠Ï†ú</button>

            </div>
        </div>
    </div>

</div>

<script>
    let pendingDeleteNickname = null;

    function showConfirmDelete(nickname) {
        pendingDeleteNickname = nickname;
        document.getElementById("confirm-message").textContent = `${nickname}ÎãòÏùÑ Ïù¥ÏõÉÎ™©Î°ùÏóêÏÑú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
        document.getElementById("confirm-alert").classList.remove("hidden");
    }

    document.addEventListener("DOMContentLoaded", () => {
        // ÏÇ≠Ï†ú Î≤ÑÌäºÏóê ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞
        document.querySelectorAll(".delete-btn").forEach(button => {
            button.addEventListener("click", () => {
                const nickname = button.getAttribute("data-nickname");
                showConfirmDelete(nickname);
            });
        });

        // ÏÇ≠Ï†ú
        document.getElementById("confirm-ok").addEventListener("click", async () => {
            if (!pendingDeleteNickname) return;

            try {
                await fetch(`/api/neighbors/remove?targetNickname=${pendingDeleteNickname}`, {
                    method: "DELETE"
                });
                location.reload();
            } catch (error) {
                console.error("ÏÇ≠Ï†ú Ïã§Ìå®:", error);
                alert("Ïù¥ÏõÉ ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
            }

            document.getElementById("confirm-alert").classList.add("hidden");
        });

        // Ï∑®ÏÜå
        document.getElementById("confirm-cancel").addEventListener("click", () => {
            document.getElementById("confirm-alert").classList.add("hidden");
        });
    });
</script>


</body>
</html>
